# docker box definition
#box: maven:3.5.0
# # defining the dev pipeline
build: 
  box: "maven:3.5.0"
  steps: 
    - xenoterracide/maven: 
        goals: package
    - script: 
        code: "cp pom.xml $WERCKER_OUTPUT_DIR"
        name: "copy artifacts"
dev: 
  box: "maven:3.5.0"
  steps: 
    - script: 
        code: |
            export http_proxy=http://www-proxy.us.oracle.com:80
            export https_proxy=http://www-proxy.us.oracle.com:80
        name: Exporting_proxy
    - xenoterracide/maven: 
        goals: package
        settings: settings.xml
maven-test: 
  box: "maven:3.5.0"
  steps: 
    - script: 
        code: "cp pom.xml $WERCKER_OUTPUT_DIR"
        name: "copy artifacts"
    - xenoterracide/maven: 
      goals: test
      type: "maven test"

push-tomcat-to-docker: 
  box: "tomcat:7.0"
  steps: 
    - internal/docker-push: 
        password: $DOCKER_PASSWORD
        registry: "https://registry.hub.docker.com"
        repository: sachinapatil/counterwebapp
        tag: prod-release-1.0.0
        username: $DOCKER_USERNAME
push-war-to-docker: 
  box: "busybox:latest"
  steps: 
    - script: 
        code: |
            mkdir /app
            cp  $WERCKER_OUTPUT_DIR/CounterWebApp.war /app
        name: "copy war file"
    - internal/docker-push: 
        cmd: "cp CounterWebApp.war /app && tail -f /dev/null"
        password: $DOCKER_PASSWORD
        registry: "https://registry.hub.docker.com"
        repository: sachinapatil/counterwebapp
        tag: war-container-1.0.0
        username: $DOCKER_USERNAME
