# docker box definition
#box: maven:3.5.0
# # defining the dev pipeline
dev:
   box: maven:3.5.0
   steps:
     - script:
           name: Exporting_proxy
           code: |
                export http_proxy=http://www-proxy.us.oracle.com:80
                export https_proxy=http://www-proxy.us.oracle.com:80
     - xenoterracide/maven:
        settings: settings.xml
        goals: package

build:
   box: maven:3.5.0
   steps:
      - xenoterracide/maven:
         goals: package
      - script:
            name: copy artifacts
            code: cp target/CounterWebApp.war $WERCKER_OUTPUT_DIR
            code: cp pom.xml $WERCKER_OUTPUT_DIR

maven-test:
   box: maven:3.5.0
   steps:
     - script:
            name: copy artifacts
            code: cp CounterWebApp.war $WERCKER_OUTPUT_DIR
            code: cp pom.xml $WERCKER_OUTPUT_DIR
    - xenoterracide/maven:
        type: maven test
        goals: test

push-war-to-docker:
   box: busybox:latest
   steps:
     - script:
           name: copy war file
           code: |            
            mkdir /app    
            cp  $WERCKER_OUTPUT_DIR/CounterWebApp.war /app
     - internal/docker-push:
           username: $DOCKER_USERNAME
           password: $DOCKER_PASSWORD
           tag: war-container-1.0.0
           repository: sachinapatil/counterwebapp
           registry: https://registry.hub.docker.com
           cmd: "cp CounterWebApp.war /app && tail -f /dev/null"     

push-tomcat-to-docker:
  box: tomcat:7.0
  steps:
    - internal/docker-push:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        tag: prod-release-1.0.0
        repository: sachinapatil/counterwebapp
        registry: https://registry.hub.docker.com                

