# docker box definition
#box: maven:3.5.0
# # defining the dev pipeline
dev:
   box: maven:3.5.0
   steps:
     - script:
           name: Exporting_proxy
           code: |
                export http_proxy=http://www-proxy.us.oracle.com:80
                export https_proxy=http://www-proxy.us.oracle.com:80
     - xenoterracide/maven:
        settings: settings.xml
        goals: package

maven-test:
   box: maven:3.5.0
   steps:
    - xenoterracide/maven:
        type: maven test
        goals: test

build:
   box: maven:3.5.0
   steps:
      - xenoterracide/maven:
         goals: package
      - script:
            name: copy artifacts
            code: cp target/CounterWebApp.war $WERCKER_OUTPUT_DIR

#push-to-ecr:
#  steps:
#    - internal/docker-push:
#        aws-access-key: $AWS_ACCESS_KEY_ID
#        aws-secret-key: $AWS_SECRET_ACCESS_KEY
#        aws-region: $AWS_REGION
#        aws-registry-id: $AWS_REGISTRY_ID
#        repository: $REPOSITORY_NAME
#
#deploy:
#  steps:
#    - script:
#           name: Exporting_proxy
#           code: |
#                scp -p22 -ihghia_id_rsa -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no target/CounterWebApp.war hghia@10.180.61.180:/var/www
#
push-war-to-docker:
   box: busybox:latest
   steps:
     - script:
           name: copy war file
           code: |            
            mkdir /app    
            cp  $WERCKER_OUTPUT_DIR/CounterWebApp.war /app
     - internal/docker-push:
           username: $DOCKER_USERNAME
           password: $DOCKER_PASSWORD
           tag: war-container-1.0.0
           repository: sachinapatil/counterwebapp
           registry: https://registry.hub.docker.com
           cmd: "cp CounterWebApp.war /app && tail -f /dev/null"     

push-tomcat-to-docker:
  box: tomcat:7.0
  steps:
    - internal/docker-push:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        tag: prod-release-1.0.0
        repository: sachinapatil/counterwebapp
        registry: https://registry.hub.docker.com                

